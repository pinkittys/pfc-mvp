<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlainFlowerClub - í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 40px 20px;
            background: #f8f9fa;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .brand {
            font-size: 32px;
            font-weight: bold;
            color: #2C3E50;
            margin-bottom: 8px;
        }
        
        .subtitle {
            font-size: 16px;
            color: #6c757d;
        }
        
        .test-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        }
        
        .test-button {
            background: #2C3E50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            background: #34495E;
            transform: translateY(-1px);
        }
        
        .test-button.success {
            background: #27ae60;
        }
        
        .test-button.error {
            background: #e74c3c;
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
            text-align: left;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .loading {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .story-input {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid #E9ECEF;
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 15px;
        }
        
        .story-input:focus {
            outline: none;
            border-color: #2C3E50;
        }
        
        .api-info {
            background: #e3f2fd;
            color: #1565c0;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .api-url {
            font-family: monospace;
            background: #f5f5f5;
            padding: 5px 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="brand">PlainFlowerClub</div>
            <div class="subtitle">í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì API í…ŒìŠ¤íŠ¸</div>
        </div>
        
        <div class="api-info">
            <h3>ğŸ“¡ API ì„œë²„ ì •ë³´</h3>
            <p><strong>í˜„ì¬ URL:</strong></p>
            <div class="api-url">https://port-0-plainflowerclub-mej0wlho47c6df8c.sel5.cloudtype.app/api/v1</div>
            <p><strong>í–¥í›„ URL (SSL í•´ê²° í›„):</strong></p>
            <div class="api-url">https://api.plainflowerclub.com/api/v1</div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ” ê¸°ë³¸ API í…ŒìŠ¤íŠ¸</h3>
            <button class="test-button" onclick="testHealth()">Health Check</button>
            <button class="test-button" onclick="testAllEndpoints()">ì „ì²´ ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸</button>
            <div id="basicResult" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸŒº ê½ƒ ì¶”ì²œ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h3>
            <textarea class="story-input" id="storyInput" placeholder="ìŠ¤í† ë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”... ì˜ˆ: ì˜¤ëŠ˜ ì¹œêµ¬ì™€ í•¨ê»˜ ì¹´í˜ì— ê°”ì–´ìš”. ë¶„ìœ„ê¸°ê°€ ì •ë§ ì¢‹ì•˜ê³  ì»¤í”¼ë„ ë§›ìˆì—ˆì–´ìš”.">ì˜¤ëŠ˜ ì¹œêµ¬ì™€ í•¨ê»˜ ì¹´í˜ì— ê°”ì–´ìš”. ë¶„ìœ„ê¸°ê°€ ì •ë§ ì¢‹ì•˜ê³  ì»¤í”¼ë„ ë§›ìˆì—ˆì–´ìš”.</textarea>
            <button class="test-button" onclick="testFastContext()">ë¹ ë¥¸ í‚¤ì›Œë“œ ì¶”ì¶œ</button>
            <button class="test-button" onclick="testExtractContext()">ìƒì„¸ í‚¤ì›Œë“œ ì¶”ì¶œ</button>
            <button class="test-button" onclick="testEmotionAnalysis()">ê°ì • ë¶„ì„</button>
            <button class="test-button" onclick="testFullRecommendation()">ì „ì²´ ê½ƒ ì¶”ì²œ</button>
            <div id="recommendationResult" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“¤ ìŠ¤í† ë¦¬ ê³µìœ  í…ŒìŠ¤íŠ¸</h3>
            <button class="test-button" onclick="testShareStory()">ìŠ¤í† ë¦¬ ê³µìœ  URL ìƒì„±</button>
            <button class="test-button" onclick="testGetSharedStory()">ê³µìœ ëœ ìŠ¤í† ë¦¬ ì¡°íšŒ</button>
            <div id="shareResult" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½</h3>
            <div id="summaryResult" class="result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://port-0-plainflowerclub-mej0wlho47c6df8c.sel5.cloudtype.app/api/v1';
        let testResults = {};
        
        function showResult(elementId, message, type = 'success') {
            const resultDiv = document.getElementById(elementId);
            resultDiv.textContent = message;
            resultDiv.className = `result ${type}`;
        }
        
        function updateButton(button, success) {
            button.className = `test-button ${success ? 'success' : 'error'}`;
            button.textContent = button.textContent + (success ? ' âœ…' : ' âŒ');
        }
        
        async function testHealth() {
            const button = event.target;
            showResult('basicResult', 'Health Check ì¤‘...', 'loading');
            
            try {
                const response = await fetch('https://port-0-plainflowerclub-mej0wlho47c6df8c.sel5.cloudtype.app/health');
                const data = await response.json();
                
                if (response.ok) {
                    showResult('basicResult', `âœ… Health Check ì„±ê³µ!\n\n${JSON.stringify(data, null, 2)}`, 'success');
                    updateButton(button, true);
                    testResults.health = true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                showResult('basicResult', `âŒ Health Check ì‹¤íŒ¨!\n\n${error.message}`, 'error');
                updateButton(button, false);
                testResults.health = false;
            }
        }
        
        async function testFastContext() {
            const button = event.target;
            const story = document.getElementById('storyInput').value;
            showResult('recommendationResult', 'ë¹ ë¥¸ í‚¤ì›Œë“œ ì¶”ì¶œ ì¤‘...', 'loading');
            
            try {
                const response = await fetch(`${API_BASE}/fast-context`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ story })
                });
                const data = await response.json();
                
                if (response.ok) {
                    showResult('recommendationResult', `âœ… ë¹ ë¥¸ í‚¤ì›Œë“œ ì¶”ì¶œ ì„±ê³µ!\n\n${JSON.stringify(data, null, 2)}`, 'success');
                    updateButton(button, true);
                    testResults.fastContext = true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                showResult('recommendationResult', `âŒ ë¹ ë¥¸ í‚¤ì›Œë“œ ì¶”ì¶œ ì‹¤íŒ¨!\n\n${error.message}`, 'error');
                updateButton(button, false);
                testResults.fastContext = false;
            }
        }
        
        async function testExtractContext() {
            const button = event.target;
            const story = document.getElementById('storyInput').value;
            showResult('recommendationResult', 'ìƒì„¸ í‚¤ì›Œë“œ ì¶”ì¶œ ì¤‘...', 'loading');
            
            try {
                const response = await fetch(`${API_BASE}/extract-context`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ story })
                });
                const data = await response.json();
                
                if (response.ok) {
                    showResult('recommendationResult', `âœ… ìƒì„¸ í‚¤ì›Œë“œ ì¶”ì¶œ ì„±ê³µ!\n\n${JSON.stringify(data, null, 2)}`, 'success');
                    updateButton(button, true);
                    testResults.extractContext = true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                showResult('recommendationResult', `âŒ ìƒì„¸ í‚¤ì›Œë“œ ì¶”ì¶œ ì‹¤íŒ¨!\n\n${error.message}`, 'error');
                updateButton(button, false);
                testResults.extractContext = false;
            }
        }
        
        async function testEmotionAnalysis() {
            const button = event.target;
            const story = document.getElementById('storyInput').value;
            showResult('recommendationResult', 'ê°ì • ë¶„ì„ ì¤‘...', 'loading');
            
            try {
                const response = await fetch(`${API_BASE}/emotion-analysis`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ story })
                });
                const data = await response.json();
                
                if (response.ok) {
                    showResult('recommendationResult', `âœ… ê°ì • ë¶„ì„ ì„±ê³µ!\n\n${JSON.stringify(data, null, 2)}`, 'success');
                    updateButton(button, true);
                    testResults.emotionAnalysis = true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                showResult('recommendationResult', `âŒ ê°ì • ë¶„ì„ ì‹¤íŒ¨!\n\n${error.message}`, 'error');
                updateButton(button, false);
                testResults.emotionAnalysis = false;
            }
        }
        
        async function testFullRecommendation() {
            const button = event.target;
            const story = document.getElementById('storyInput').value;
            showResult('recommendationResult', 'ì „ì²´ ê½ƒ ì¶”ì²œ ì¤‘...', 'loading');
            
            try {
                // 1. í‚¤ì›Œë“œ ì¶”ì¶œ
                const contextResponse = await fetch(`${API_BASE}/fast-context`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ story })
                });
                const contextData = await contextResponse.json();
                
                if (!contextResponse.ok) {
                    throw new Error(`í‚¤ì›Œë“œ ì¶”ì¶œ ì‹¤íŒ¨: HTTP ${contextResponse.status}`);
                }
                
                // 2. ê½ƒ ì¶”ì²œ
                const recommendResponse = await fetch(`${API_BASE}/recommendations`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        story: story,
                        preferred_colors: contextData.colors || [],
                        excluded_flowers: [],
                        top_k: 3
                    })
                });
                const recommendData = await recommendResponse.json();
                
                if (recommendResponse.ok) {
                    const result = {
                        context: contextData,
                        recommendations: recommendData
                    };
                    showResult('recommendationResult', `âœ… ì „ì²´ ê½ƒ ì¶”ì²œ ì„±ê³µ!\n\n${JSON.stringify(result, null, 2)}`, 'success');
                    updateButton(button, true);
                    testResults.fullRecommendation = true;
                } else {
                    throw new Error(`ê½ƒ ì¶”ì²œ ì‹¤íŒ¨: HTTP ${recommendResponse.status}`);
                }
            } catch (error) {
                showResult('recommendationResult', `âŒ ì „ì²´ ê½ƒ ì¶”ì²œ ì‹¤íŒ¨!\n\n${error.message}`, 'error');
                updateButton(button, false);
                testResults.fullRecommendation = false;
            }
        }
        
        async function testAllEndpoints() {
            const button = event.target;
            showResult('basicResult', 'ì „ì²´ ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸ ì¤‘...', 'loading');
            
            const endpoints = [
                { name: 'Health Check', path: '/health', method: 'GET', fullUrl: true },
                { name: 'Fast Context', path: '/fast-context', method: 'POST', body: { story: 'í…ŒìŠ¤íŠ¸ ìŠ¤í† ë¦¬' } },
                { name: 'Extract Context', path: '/extract-context', method: 'POST', body: { story: 'í…ŒìŠ¤íŠ¸ ìŠ¤í† ë¦¬' } },
                { name: 'Emotion Analysis', path: '/emotion-analysis', method: 'POST', body: { story: 'í…ŒìŠ¤íŠ¸ ìŠ¤í† ë¦¬' } }
            ];
            
            const results = [];
            
            for (const endpoint of endpoints) {
                try {
                    const options = {
                        method: endpoint.method,
                        headers: { 'Content-Type': 'application/json' }
                    };
                    
                    if (endpoint.body) {
                        options.body = JSON.stringify(endpoint.body);
                    }
                    
                    const url = endpoint.fullUrl ? 'https://port-0-plainflowerclub-mej0wlho47c6df8c.sel5.cloudtype.app' + endpoint.path : `${API_BASE}${endpoint.path}`;
                    const response = await fetch(url, options);
                    const data = await response.json();
                    
                    results.push({
                        endpoint: endpoint.name,
                        status: response.ok ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨',
                        statusCode: response.status,
                        data: data
                    });
                    
                    testResults[endpoint.name] = response.ok;
                } catch (error) {
                    results.push({
                        endpoint: endpoint.name,
                        status: 'âŒ ì˜¤ë¥˜',
                        error: error.message
                    });
                    testResults[endpoint.name] = false;
                }
            }
            
            const summary = results.map(r => `${r.endpoint}: ${r.status}`).join('\n');
            showResult('basicResult', `ì „ì²´ ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!\n\n${summary}`, 'success');
            updateButton(button, true);
            
            updateSummary();
        }
        
        function updateSummary() {
            const total = Object.keys(testResults).length;
            const success = Object.values(testResults).filter(Boolean).length;
            const failed = total - success;
            
            const summary = `ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½\n\n` +
                          `ì´ í…ŒìŠ¤íŠ¸: ${total}ê°œ\n` +
                          `ì„±ê³µ: ${success}ê°œ âœ…\n` +
                          `ì‹¤íŒ¨: ${failed}ê°œ âŒ\n` +
                          `ì„±ê³µë¥ : ${Math.round((success / total) * 100)}%\n\n` +
                          `ìƒì„¸ ê²°ê³¼:\n` +
                          Object.entries(testResults)
                            .map(([test, result]) => `${test}: ${result ? 'âœ…' : 'âŒ'}`)
                            .join('\n');
            
            showResult('summaryResult', summary, success === total ? 'success' : 'error');
        }
        
        async function testShareStory() {
            const button = event.target;
            showResult('shareResult', 'ìŠ¤í† ë¦¬ ê³µìœ  URL ìƒì„± ì¤‘...', 'loading');
            
            try {
                const response = await fetch(`${API_BASE}/stories/share`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ story_id: 'S250822-FLC-00001' })
                });
                const data = await response.json();
                
                if (response.ok) {
                    showResult('shareResult', `âœ… ìŠ¤í† ë¦¬ ê³µìœ  URL ìƒì„± ì„±ê³µ!\n\n${JSON.stringify(data, null, 2)}`, 'success');
                    updateButton(button, true);
                    testResults.shareStory = true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                showResult('shareResult', `âŒ ìŠ¤í† ë¦¬ ê³µìœ  URL ìƒì„± ì‹¤íŒ¨!\n\n${error.message}`, 'error');
                updateButton(button, false);
                testResults.shareStory = false;
            }
        }
        
        async function testGetSharedStory() {
            const button = event.target;
            showResult('shareResult', 'ê³µìœ ëœ ìŠ¤í† ë¦¬ ì¡°íšŒ ì¤‘...', 'loading');
            
            try {
                const response = await fetch(`${API_BASE}/stories/share/UzI1MDgyMi1GTEMtMDAwMDE=`);
                const data = await response.json();
                
                if (response.ok) {
                    showResult('shareResult', `âœ… ê³µìœ ëœ ìŠ¤í† ë¦¬ ì¡°íšŒ ì„±ê³µ!\n\n${JSON.stringify(data, null, 2)}`, 'success');
                    updateButton(button, true);
                    testResults.getSharedStory = true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                showResult('shareResult', `âŒ ê³µìœ ëœ ìŠ¤í† ë¦¬ ì¡°íšŒ ì‹¤íŒ¨!\n\n${error.message}`, 'error');
                updateButton(button, false);
                testResults.getSharedStory = false;
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ Health Check ì‹¤í–‰
        window.addEventListener('load', () => {
            setTimeout(testHealth, 1000);
        });
    </script>
</body>
</html>
